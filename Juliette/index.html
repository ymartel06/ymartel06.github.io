<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
        <style>
            body {
                font-family: 'Segoe UI', Arial, sans-serif;
                background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
                min-height: 100vh;
                margin: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: flex-start;
            }
            h1 {
                color: #2d5fa4;
                margin-top: 40px;
                margin-bottom: 30px;
                font-size: 2.2em;
                letter-spacing: 1px;
            }
            .quiz-container {
                background: #fff;
                border-radius: 16px;
                box-shadow: 0 4px 24px rgba(44, 62, 80, 0.12);
                padding: 32px 40px 28px 40px;
                margin-bottom: 40px;
                min-width: 320px;
                max-width: 400px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .question {
                font-size: 1.4em;
                color: #2d5fa4;
                margin-bottom: 18px;
                font-weight: 500;
            }
            input[type="text"] {
                font-size: 1.1em;
                padding: 8px 12px;
                border-radius: 8px;
                border: 1px solid #b2bec3;
                margin-bottom: 12px;
                width: 80%;
                box-sizing: border-box;
                outline: none;
                transition: border-color 0.2s;
            }
            input[type="text"]:focus {
                border-color: #2d5fa4;
            }
            button {
                font-size: 1.1em;
                padding: 7px 22px;
                border-radius: 8px;
                border: none;
                background: #2d5fa4;
                color: #fff;
                margin: 6px 0;
                cursor: pointer;
                box-shadow: 0 2px 8px rgba(44, 62, 80, 0.08);
                transition: background 0.2s;
            }
            button:hover {
                background: #1b3c6b;
            }
            .result {
                margin-top: 18px;
                font-size: 1.1em;
                color: #636e72;
                min-height: 24px;
                text-align: center;
            }
        </style>
</head>
<body>
    <h1>Quiz</h1>
    <div class="quiz-container">
        <label id="lbCategorySelect" for="categorySelect" style="font-size:1.1em;margin-bottom:12px;color:#2d5fa4;font-weight:500;">Choisis une catégorie :</label>
        <select id="categorySelect" style="font-size:1.1em;padding:6px 12px;border-radius:8px;border:1px solid #b2bec3;margin-bottom:18px;width:80%;"></select>
        <label id="lbQuizSelect" for="quizSelect" style="font-size:1.1em;margin-bottom:12px;color:#2d5fa4;font-weight:500;">Choisis ton quiz :</label>
        <select id="quizSelect" style="font-size:1.1em;padding:6px 12px;border-radius:8px;border:1px solid #b2bec3;margin-bottom:18px;width:80%;">
        </select>
        <button id="startBtn" onclick="startQuiz()" style="margin-bottom:18px;">Commencer</button>
        <button id="backBtn" onclick="backToMenu()" style="display:none;margin-bottom:18px;background:#636e72;">Retour au menu</button>
        <div id="quizInfo" style="display:none;margin-bottom:10px;font-size:1.1em;color:#2d5fa4;font-weight:500;"></div>
        <div class="question" id="question" style="display:none;"></div>
    <input type="text" id="answer" autocomplete="off" style="display:none;" oninput="updateValidateState()" onkeydown="handleEnter(event)" />
    <div id="choicesContainer" style="display:none;margin-bottom:12px;"></div>
    <button onclick="checkAnswer()" id="validateBtn" style="display:none;" disabled>Valider</button>
        <div class="result" id="result" style="display:none;"></div>
        <button onclick="nextQuestion()" id="nextBtn" style="display:none;">Question suivante</button>
        <div id="timer" style="display:none;margin-bottom:10px;font-size:1.1em;color:#636e72;font-weight:500;"></div>
        <div id="scoreBoard" style="display:none;margin-bottom:10px;"></div>
        <div id="namePrompt" style="display:none;margin-bottom:10px;">
            <label for="playerName" style="font-size:1.1em;color:#2d5fa4;font-weight:500;">Bravo ! Entre ton prénom :</label>
            <input type="text" id="playerName" style="font-size:1.1em;padding:6px 12px;border-radius:8px;border:1px solid #b2bec3;margin-bottom:8px;width:80%;" />
            <button onclick="saveScore()" id="saveScoreBtn" style="font-size:1.1em;padding:7px 22px;border-radius:8px;background:#27ae60;color:#fff;">Sauvegarder</button>
        </div>
    </div>

    <script>
        // Active/désactive le bouton Valider selon le champ
        function updateValidateState() {
            const select = document.getElementById('quizSelect');
            const quizName = select.value;
            const quizType = quizzes[quizName].type || "text";
            if (quizType === "multiple") {
                document.getElementById('validateBtn').disabled = !window.selectedChoice;
            } else {
                const val = document.getElementById('answer').value.trim();
                document.getElementById('validateBtn').disabled = val === "";
            }
        }

        // Valide avec Entrée si le champ n'est pas vide
        function handleEnter(e) {
            const select = document.getElementById('quizSelect');
            const quizName = select.value;
            const quizType = quizzes[quizName].type || "text";
            if (quizType === "text" && e.key === "Enter") {
                const val = document.getElementById('answer').value.trim();
                if (val !== "") {
                    checkAnswer();
                }
            }
        }
        // Récupère le label du quiz sélectionné
        function getQuizLabel() {
            const select = document.getElementById('quizSelect');
            const quizName = select.value;
            return quizzes[quizName]?.title || "";
        }

        function backToMenu() {
            // Hide quiz elements
            document.getElementById('question').style.display = 'none';
            document.getElementById('quizInfo').style.display = 'none';
            document.getElementById('answer').style.display = 'none';
            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('backBtn').style.display = 'none';
            document.getElementById('choicesContainer').style.display = 'none';
            document.getElementById('timer').style.display = 'none';
            document.getElementById('scoreBoard').style.display = 'none';
            document.getElementById('namePrompt').style.display = 'none';
            // Show menu elements            
            document.getElementById('lbCategorySelect').style.display = '';
            document.getElementById('lbQuizSelect').style.display = '';
            document.getElementById('categorySelect').style.display = '';
            document.getElementById('quizSelect').style.display = '';
            document.getElementById('startBtn').style.display = '';
        }
    // All answers are now case sensitive
    const quizzes = {
        /*
        lesson1A: {
            title: "Lesson 1 A new year (B)",
            category: "Anglais - Primaire - Vocabulaire",
            caseSensitive: false,
            type: "text",
            questions: [
                { a: "committee", q: "comité" },
                { a: "some", q: "quelques" },
                { a: "track and field", q: "athlétisme" },
                { a: "classmate", q: "camarade de classe" },
                { a: "for", q: "pour" },
                { a: "robotic", q: "robotique" },
                { a: "more", q: "plus" },
                { a: "spanish", q: "espagnol" },
                { a: "band", q: "groupe" },
                { a: "math", q: "mathématiques" },
                { a: "chart", q: "graphique" },
                { a: "below", q: "ci-dessous" },
                { a: "if so", q: "si oui" },
                { a: "student", q: "étudiant" },
                { a: "name", q: "nom" },
                { a: "enough", q: "assez" },
                { a: "to listen", q: "écouter" },
                { a: "to match", q: "correspondre à" },
                { a: "to do", q: "faire" },
                { a: "to ask", q: "demander" },
                { a: "to work", q: "travailler" },
                { a: "to write", q: "écrire" },
                { a: "to exercise", q: "s'éxercer" },
                { a: "to learn", q: "apprendre" }
            ]
        },
        */
        lesson3A: {
            title: "Lesson 3 Working well together (A)",
            category: "Anglais - Primaire - Vocabulaire",
            caseSensitive: false,
            type: "text",
            questions: [
                { a: "pet", q: "animal de compagnie" },
                { a: "to mime a monkey", q: "mimer un singe" },
                { a: "meal", q: "repas" },
                { a: "slowly", q: "lentement" },
                { a: "birthday", q: "anniversaire" },
                { a: "store", q: "magasin" },
                { a: "peer", q: "pair" },
                { a: "task", q: "tâche" },
                { a: "wheel", q: "roue" },
                { a: "skateboard", q: "planche à roulette" },
                { a: "respectful", q: "respectueux" },
                { a: "member", q: "membre" },
                { a: "membership", q: "adhésion" },
                { a: "to work", q: "travailler" },
                { a: "to present a story", q: "présenter une histoire" },
                { a: "even if", q: "même si" },
                { a: "to help", q: "aider à" },
                { a: "to share with", q: "partager avec" },
                { a: "to repeat", q: "répéter" },
                { a: "to speak", q: "parler" },
                { a: "to take turn", q: "prendre son tour" },
                { a: "to cooperate", q: "coopérer" },
                { a: "to pay attention", q: "faire attention" },
                { a: "to take risk", q: "prendre des risques" }
            ]
        },
        lesson3B: {
            title: "Lesson 3 Working well together (B)",
            category: "Anglais - Primaire - Vocabulaire",
            caseSensitive: false,
            type: "text",
            questions: [
                { a: "title", q: "titre" },
                { a: "picture", q: "image" },
                { a: "keyword", q: "mot-clé" },
                { a: "movie", q: "film" },
                { a: "probably", q: "probablement" },
                { a: "available", q: "disponible" },
                { a: "kid", q: "enfant" },
                { a: "utensil", q: "ustensile" },
                { a: "in a different way", q: "d'une autre façon" },
                { a: "quickly", q: "rapidement" },
                { a: "single", q: "célibataire" },
                { a: "per family", q: "par famille" },
                { a: "holiday", q: "vacances" },
                { a: "in French", q: "en français" },
                { a: "the United States", q: "Les États Unis" },
                { a: "tool", q: "outil" },
                { a: "to delay", q: "retarder" },
                { a: "to say", q: "dire" },
                { a: "to practice", q: "pratiquer" },
                { a: "to shop", q: "faire des courses" },
                { a: "to touch", q: "toucher" },
                { a: "to explain", q: "expliquer" },
                { a: "to participate", q: "participer" },
                { a: "to know", q: "savoir" }
            ]
        },
        days: {
            title: "Jours de la semaine",
            category: "Anglais - Vocabulaire",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "Lundi", a: "Monday" },
                { q: "Mardi", a: "Tuesday" },
                { q: "Mercredi", a: "Wednesday" },
                { q: "Jeudi", a: "Thursday" },
                { q: "Vendredi", a: "Friday" },
                { q: "Samedi", a: "Saturday" },
                { q: "Dimanche", a: "Sunday" }
            ]
        },
        months: {
            title: "Mois de l'année",
            category: "Anglais - Vocabulaire",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "Janvier", a: "January" },
                { q: "Février", a: "February" },
                { q: "Mars", a: "March" },
                { q: "Avril", a: "April" },
                { q: "Mai", a: "May" },
                { q: "Juin", a: "June" },
                { q: "Juillet", a: "July" },
                { q: "Août", a: "August" },
                { q: "Septembre", a: "September" },
                { q: "Octobre", a: "October" },
                { q: "Novembre", a: "November" },
                { q: "Décembre", a: "December" }
            ]
        },
        numbers: {
            title: "Chiffres",
            category: "Anglais - Vocabulaire",
            caseSensitive: false,
            type: "text",
            questions: [
                { q: "Un", a: "One" },
                { q: "Deux", a: "Two" },
                { q: "Trois", a: "Three" },
                { q: "Quatre", a: "Four" },
                { q: "Cinq", a: "Five" },
                { q: "Six", a: "Six" },
                { q: "Sept", a: "Seven" },
                { q: "Huit", a: "Eight" },
                { q: "Neuf", a: "Nine" },
                { q: "Dix", a: "Ten" },
                { q: "Onze", a: "Eleven" },
                { q: "Douze", a: "Twelve" },
                { q: "Treize", a: "Thirteen" },
                { q: "Quatorze", a: "Fourteen" },
                { q: "Quinze", a: "Fifteen" },
                { q: "Seize", a: "Sixteen" },
                { q: "Dix-sept", a: "Seventeen" },
                { q: "Dix-huit", a: "Eighteen" },
                { q: "Dix-neuf", a: "Nineteen" },
                { q: "Vingt", a: "Twenty" },
                { q: "Trente", a: "Thirty" },
                { q: "Quarante", a: "Forty" },
                { q: "Cinquante", a: "Fifty" },
                { q: "Soixante", a: "Sixty" },
                { q: "Soixante-dix", a: "Seventy" },
                { q: "Quatre-vingts", a: "Eighty" },
                { q: "Quatre-vingt-dix", a: "Ninety" },
                { q: "Cent", a: "One hundred" }
            ]
        },
        be_present: {
            title: "To be - Présent",
            category: "Anglais - Verbes",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "Je suis", a: "I am" },
                { q: "Tu es", a: "You are" },
                { q: "Il est", a: "He is" },
                { q: "Elle est", a: "She is" },
                { q: "Nous sommes", a: "We are" },
                { q: "Vous êtes", a: "You are" },
                { q: "Ils sont", a: "They are" },
                { q: "Elles sont", a: "They are" }
            ]
        },
        be_past: {
            title: "To be - Passé",
            category: "Anglais - Verbes",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "J'étais", a: "I was" },
                { q: "Tu étais", a: "You were" },
                { q: "Il était", a: "He was" },
                { q: "Elle était", a: "She was" },
                { q: "Nous étions", a: "We were" },
                { q: "Vous étiez", a: "You were" },
                { q: "Ils étaient", a: "They were" },
                { q: "Elles étaient", a: "They were" }
            ]
        },
        be_future: {
            title: "To be - Futur",
            category: "Anglais - Verbes",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "Je serai", a: "I will be" },
                { q: "Tu seras", a: "You will be" },
                { q: "Il sera", a: "He will be" },
                { q: "Elle sera", a: "She will be" },
                { q: "Nous serons", a: "We will be" },
                { q: "Vous serez", a: "You will be" },
                { q: "Ils seront", a: "They will be" },
                { q: "Elles seront", a: "They will be" }
            ]
        },
        have_present: {
            title: "To have - Présent",
            category: "Anglais - Verbes",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "J'ai", a: "I have" },
                { q: "Tu as", a: "You have" },
                { q: "Il a", a: "He has" },
                { q: "Elle a", a: "She has" },
                { q: "Nous avons", a: "We have" },
                { q: "Vous avez", a: "You have" },
                { q: "Ils ont", a: "They have" },
                { q: "Elles ont", a: "They have" }
            ]
        },
        have_past: {
            title: "To have - Passé",
            category: "Anglais - Verbes",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "J'avais", a: "I had" },
                { q: "Tu avais", a: "You had" },
                { q: "Il avait", a: "He had" },
                { q: "Elle avait", a: "She had" },
                { q: "Nous avions", a: "We had" },
                { q: "Vous aviez", a: "You had" },
                { q: "Ils avaient", a: "They had" },
                { q: "Elles avaient", a: "They had" }
            ]
        },
        have_future: {
            title: "To have - Futur",
            category: "Anglais - Verbes",
            caseSensitive: true,
            type: "text",
            questions: [
                { q: "J'aurai", a: "I will have" },
                { q: "Tu auras", a: "You will have" },
                { q: "Il aura", a: "He will have" },
                { q: "Elle aura", a: "She will have" },
                { q: "Nous aurons", a: "We will have" },
                { q: "Vous aurez", a: "You will have" },
                { q: "Ils auront", a: "They will have" },
                { q: "Elles auront", a: "They will have" }
            ]
        },
        dertiminants: {
            title: "Determinants",
            category: "Français - Vocabulaire",
            caseSensitive: false,
            type: "multiple",
            questions: [
                { q: "Un", a: 1, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Plusieurs", a: 1, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Tout", a: 1, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Chaque", a: 1, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Le", a: 0, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "La", a: 0, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Les", a: 0, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Mon", a: 2, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Ta", a: 2, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Ses", a: 2, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Son", a: 2, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Notre", a: 2, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Leur", a: 2, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Ce", a: 3, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Cet", a: 3, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Ces", a: 3, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] },
                { q: "Quatre", a: 4, choices: ["Défini", "Indéfini", "Possessif", "Démonstratif", "Numéral"] }
            ]
        },
        pronoms: {
            title: "Pronoms",
            category: "Français - Vocabulaire",
            caseSensitive: false,
            type: "multiple",
            questions: [
                { q: "Je", a: 0, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Moi", a: 0, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "On", a: 0, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Eux", a: 0, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Ce", a: 1, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Ça", a: 1, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Celui", a: 1, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Cela", a: 1, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Qui", a: 2, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Que", a: 2, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Dont", a: 2, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Où", a: 2, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Lequel", a: 2, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Certains", a: 3, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Beaucoup", a: 3, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Personne", a: 3, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Plusieurs", a: 3, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Le mien", a: 4, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Le nôtre", a: 4, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] },
                { q: "Les tiens", a: 4, choices: ["Personel", "Démonstratif", "Relatif", "Indéfini", "Possessif"] }
            ]
        },
        pronouns_en: {
            title: "Pronoms anglais",
            category: "Anglais - Vocabulaire",
            caseSensitive: false,
            type: "text",
            questions: [
                { q: "Moi", a: "me" },
                { q: "Toi", a: "you" },
                { q: "Lui (exemple, c'est lui)", a: "him" },
                { q: "Elle (exemple, c'est elle)", a: "her" },
                { q: "Ça / Cela", a: "it" },
                { q: "Nous (exemple, c'est nous)", a: "us" },
                { q: "Eux (exemple, c'est eux)", a: "them" },
                { q: "Le mien", a: "mine" },
                { q: "Le tien", a: "yours" },
                { q: "Le sien (masculin)", a: "his" },
                { q: "Le sien (féminin)", a: "hers" },
                { q: "Le sien (neutre)", a: "its" },
                { q: "Le nôtre", a: "ours" },
                { q: "Le leur", a: "theirs" }
            ]
        },
        reflexive_pronouns_en: {
            title: "Reflexive pronouns",
            category: "Anglais - Vocabulaire",
            caseSensitive: false,
            type: "text",
            questions: [
                { q: "Moi-même", a: "myself" },
                { q: "Toi-même", a: "yourself" },
                { q: "Lui-même", a: "himself" },
                { q: "Elle-même", a: "herself" },
                { q: "Nous-mêmes", a: "ourselves" },
                { q: "Vous-même", a: "yourself" },
                { q: "Vous-mêmes", a: "yourselves" },
                { q: "Eux-mêmes", a: "themselves" },
                { q: "Lui-même (neutre/objet/animal)", a: "itself" }
            ]
        }
    };

    // Remplit le select categorySelect dynamiquement
    function fillCategorySelect() {
        const select = document.getElementById('categorySelect');
        select.innerHTML = "";
        const categories = [...new Set(Object.values(quizzes).map(q => q.category))];
        categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat;
            option.textContent = cat;
            select.appendChild(option);
        });
    }

    // Remplit le select quizSelect dynamiquement selon la catégorie
    function fillQuizSelect() {
        const select = document.getElementById('quizSelect');
        const category = document.getElementById('categorySelect').value;
        select.innerHTML = "";
        Object.entries(quizzes).forEach(([key, quiz]) => {
            if (quiz.category === category) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = quiz.title;
                select.appendChild(option);
            }
        });
    }

    // Met à jour quizSelect quand la catégorie change
    document.addEventListener('DOMContentLoaded', () => {
        fillCategorySelect();
        fillQuizSelect();
        document.getElementById('categorySelect').addEventListener('change', fillQuizSelect);
    });

    let current = 0;
    let wrongAnswers = [];
    let quizQueue = [];
    let timerInterval = null;
    let startTime = null;
    let elapsed = 0;
    let quizFinished = false;
    let lastScore = null;

    function startQuiz() {
        const select = document.getElementById('quizSelect');
        const quizName = select.value;
        quizQueue = shuffle([...quizzes[quizName].questions]);
        current = 0;
        wrongAnswers = [];
        // Hide select and start button
        select.style.display = 'none';
        document.getElementById('lbQuizSelect').style.display = 'none';
        document.getElementById('lbCategorySelect').style.display = 'none';
        document.getElementById('categorySelect').style.display = 'none';
        document.getElementById('startBtn').style.display = 'none';
        // Show quiz elements
        document.getElementById('question').style.display = '';
        document.getElementById('answer').style.display = '';
        document.getElementById('validateBtn').style.display = '';
        document.getElementById('result').style.display = '';
        document.getElementById('nextBtn').style.display = '';
        document.getElementById('backBtn').style.display = '';
        document.getElementById('quizInfo').style.display = '';
        document.getElementById('choicesContainer').style.display = 'none';
        document.getElementById('timer').style.display = '';
        document.getElementById('scoreBoard').style.display = 'none';
        document.getElementById('namePrompt').style.display = 'none';
        elapsed = 0;
        quizFinished = false;
        lastScore = null;
        startTime = Date.now();
        updateTimer();
        timerInterval = setInterval(updateTimer, 1000);
        showQuestion();
    }

    // Mélange aléatoire d'un tableau
    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function showQuestion() {
        if (quizQueue.length === 0) {
            if (wrongAnswers.length > 0) {
                quizQueue = [...wrongAnswers];
                wrongAnswers = [];
                current = 0;
                document.getElementById('result').textContent = "On recommence les questions mal répondues !";
                setTimeout(showQuestion, 1500);
                return;
            } else {                
                document.getElementById('question').textContent = "Quiz terminé !";
                document.getElementById('quizInfo').style.display = 'none';
                document.getElementById('choicesContainer').style.display = 'none';
                document.getElementById('answer').style.display = "none";
                document.getElementById('validateBtn').style.display = "none";
                document.getElementById('nextBtn').style.display = "none";
                document.getElementById('result').textContent = "Bravo, tu as fini !";
                document.getElementById('backBtn').style.display = '';
                endQuiz();
                return;
            }
        }
        document.getElementById('quizInfo').innerHTML = getQuizLabel() + " &nbsp;|&nbsp; " + (current + 1) + "/" + (quizQueue.length);
        document.getElementById('question').textContent = quizQueue[current].q;
        document.getElementById('answer').value = "";
        document.getElementById('result').textContent = "";
        updateValidateState();

        const select = document.getElementById('quizSelect');
        const quizName = select.value;
        const quizType = quizzes[quizName].type || "text";
        document.getElementById('answer').style.display = quizType === "text" ? "" : "none";
        document.getElementById('choicesContainer').style.display = quizType === "multiple" ? "" : "none";
        document.getElementById('validateBtn').style.display = quizType === "text" ? '' : 'none';
        document.getElementById('result').textContent = "";
        document.getElementById('answer').value = "";
        document.getElementById('answer').disabled = false;
        updateValidateState();

        if (quizType === "multiple") {
            renderChoices(quizQueue[current]);
        } else {
            document.getElementById('choicesContainer').innerHTML = "";
        }
    }

    function renderChoices(questionObj) {
        const container = document.getElementById('choicesContainer');
        container.innerHTML = "";
        questionObj.choices.forEach((choice, idx) => {
            const btn = document.createElement('button');
            btn.textContent = choice;
            btn.style.margin = "4px";
            btn.onclick = function() {
                selectChoice(idx);
                checkAnswer();
            };
            btn.className = "choice-btn";
            container.appendChild(btn);
        });
        window.selectedChoice = null;
        updateValidateState();
    }

    function selectChoice(idx) {
        window.selectedChoice = idx;
        document.querySelectorAll('.choice-btn').forEach((btn, i) => {
            btn.style.background = i === idx ? "#27ae60" : "#2d5fa4";
        });
        updateValidateState();
    }

    function checkAnswer() {
        const select = document.getElementById('quizSelect');
        const quizName = select.value;
        const quizType = quizzes[quizName].type || "text";
        const correct = quizQueue[current].a;
        let isGood = false;
        let match = false;
        if (quizType === "multiple") {
            match = window.selectedChoice === correct;
        } else {
            const userAnswer = document.getElementById('answer').value.trim();
            const caseSensitive = quizzes[quizName].caseSensitive;
            if (caseSensitive) {
                match = userAnswer === correct;
            } else {
                match = userAnswer.toLowerCase() === correct.toLowerCase();
            }
        }
        if (match) {
            document.getElementById('result').innerHTML = "<span style='color:#27ae60;font-weight:bold;'>Bravo !</span>";
            isGood = true;
        } else {
            let correctText = quizType === "multiple"
                ? quizQueue[current].choices[correct]
                : correct;
            document.getElementById('result').innerHTML = "Non, la bonne réponse est : <span style='color:#d63031;font-weight:bold;'>" + correctText + "</span>";
            wrongAnswers.push(quizQueue[current]);
        }
        document.getElementById('validateBtn').disabled = true;
        document.getElementById('answer').disabled = true;
        document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);
        setTimeout(() => {
            document.getElementById('validateBtn').disabled = false;
            document.getElementById('answer').disabled = false;
            document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = false);
            nextQuestion();
        }, isGood ? 2000 : 3000);
    }

    function nextQuestion() {
        current++;
        if (current >= quizQueue.length) {
            quizQueue = quizQueue.slice(current); // Remove answered
            current = 0;
            showQuestion();
        } else {
            showQuestion();
        }
    }

    function updateTimer() {
        if (quizFinished) return;
        elapsed = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById('timer').textContent = "Temps écoulé : " + elapsed + "s";
    }
	
    function endQuiz() {
        quizFinished = true;
        clearInterval(timerInterval);
        document.getElementById('timer').style.display = '';
        document.getElementById('timer').textContent = "Temps total : " + elapsed + "s";
        document.getElementById('scoreBoard').style.display = '';
        showScores();
        lastScore = elapsed;
        const quizName = document.getElementById('quizSelect').value;
        if (isTopScore(quizName, elapsed)) {
            document.getElementById('namePrompt').style.display = '';
        } else {
            document.getElementById('namePrompt').style.display = 'none';
        }
    }

    function showScores() {
        const quizName = document.getElementById('quizSelect').value;
        const scores = getScores(quizName);
        let html = "<strong>TOP 5 scores :</strong><br>";
        if (scores.length === 0) {
            html += "<em>Aucun score enregistré.</em>";
        } else {
            html += "<ol style='padding-left:20px;'>";
            scores.forEach(s => {
                html += "<li>" + s.name + " : " + s.time + "s</li>";
            });
            html += "</ol>";
        }
        document.getElementById('scoreBoard').innerHTML = html;
    }

    function getScores(quizName) {
        const key = "scores_" + quizName;
        const scores = JSON.parse(localStorage.getItem(key) || "[]");
        return scores;
    }

    function saveScores(quizName, scores) {
        const key = "scores_" + quizName;
        localStorage.setItem(key, JSON.stringify(scores));
    }

    function isTopScore(quizName, time) {
        const scores = getScores(quizName);
        if (scores.length < 5) return true;
        return scores.some(s => time < s.time);
    }

    function saveScore() {
        const quizName = document.getElementById('quizSelect').value;
        const name = document.getElementById('playerName').value.trim() || "Anonyme";
        let scores = getScores(quizName);
        scores.push({ name, time: lastScore });
        scores = scores.sort((a, b) => a.time - b.time).slice(0, 5);
        saveScores(quizName, scores);
        document.getElementById('namePrompt').style.display = 'none';
        showScores();
    }

    </script>
</body>
</html>